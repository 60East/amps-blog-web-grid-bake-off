!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.amps=t():e.amps=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=12)}([function(e,t,r){(function(e){var t=function(e){"use strict";function r(e,t){return void 0===e?r[0]:void 0!==t?10==+t?F(e):ee(e,t):F(e)}function n(e,t){this.value=e,this.sign=t,this.isSmall=!1}function i(e){this.value=e,this.sign=e<0,this.isSmall=!0}function o(e){return-Q<e&&e<Q}function s(e){return e<1e7?[e]:e<1e14?[e%1e7,Math.floor(e/1e7)]:[e%1e7,Math.floor(e/1e7)%1e7,Math.floor(e/1e14)]}function a(e){u(e);var t=e.length;if(t<4&&x(e,Z)<0)switch(t){case 0:return 0;case 1:return e[0];case 2:return e[0]+e[1]*W;default:return e[0]+(e[1]+e[2]*W)*W}return e}function u(e){for(var t=e.length;0===e[--t];);e.length=t+1}function c(e){for(var t=new Array(e),r=-1;++r<e;)t[r]=0;return t}function h(e){return e>0?Math.floor(e):Math.ceil(e)}function p(e,t){var r,n,i=e.length,o=t.length,s=new Array(i),a=0,u=W;for(n=0;n<o;n++)r=e[n]+t[n]+a,a=r>=u?1:0,s[n]=r-a*u;for(;n<i;)r=e[n]+a,a=r===u?1:0,s[n++]=r-a*u;return a>0&&s.push(a),s}function d(e,t){return e.length>=t.length?p(e,t):p(t,e)}function l(e,t){var r,n,i=e.length,o=new Array(i),s=W;for(n=0;n<i;n++)r=e[n]-s+t,t=Math.floor(r/s),o[n]=r-t*s,t+=1;for(;t>0;)o[n++]=t%s,t=Math.floor(t/s);return o}function f(e,t){var r,n,i=e.length,o=t.length,s=new Array(i),a=0,c=W;for(r=0;r<o;r++)n=e[r]-a-t[r],n<0?(n+=c,a=1):a=0,s[r]=n;for(r=o;r<i;r++){if(!((n=e[r]-a)<0)){s[r++]=n;break}n+=c,s[r]=n}for(;r<i;r++)s[r]=e[r];return u(s),s}function m(e,t,r){var o;return x(e,t)>=0?o=f(e,t):(o=f(t,e),r=!r),o=a(o),"number"==typeof o?(r&&(o=-o),new i(o)):new n(o,r)}function _(e,t,r){var o,s,u=e.length,c=new Array(u),h=-t,p=W;for(o=0;o<u;o++)s=e[o]+h,h=Math.floor(s/p),s%=p,c[o]=s<0?s+p:s;return c=a(c),"number"==typeof c?(r&&(c=-c),new i(c)):new n(c,r)}function y(e,t){var r,n,i,o,s,a=e.length,h=t.length,p=a+h,d=c(p),l=W;for(i=0;i<a;++i){o=e[i];for(var f=0;f<h;++f)s=t[f],r=o*s+d[i+f],n=Math.floor(r/l),d[i+f]=r-n*l,d[i+f+1]+=n}return u(d),d}function b(e,t){var r,n,i=e.length,o=new Array(i),s=W,a=0;for(n=0;n<i;n++)r=e[n]*t+a,a=Math.floor(r/s),o[n]=r-a*s;for(;a>0;)o[n++]=a%s,a=Math.floor(a/s);return o}function v(e,t){for(var r=[];t-- >0;)r.push(0);return r.concat(e)}function g(e,t){var r=Math.max(e.length,t.length);if(r<=30)return y(e,t);r=Math.ceil(r/2);var n=e.slice(r),i=e.slice(0,r),o=t.slice(r),s=t.slice(0,r),a=g(i,s),c=g(n,o),h=g(d(i,n),d(s,o)),p=d(d(a,v(f(f(h,a),c),r)),v(c,2*r));return u(p),p}function w(e,t){return-.012*e-.012*t+15e-6*e*t>0}function k(e,t,r){return e<W?new n(b(t,e),r):new n(y(t,s(e)),r)}function S(e){var t,r,n,i,o,s=e.length,a=c(s+s),h=W;for(n=0;n<s;n++){i=e[n];for(var p=0;p<s;p++)o=e[p],t=i*o+a[n+p],r=Math.floor(t/h),a[n+p]=t-r*h,a[n+p+1]+=r}return u(a),a}function T(e,t){var r,n,i,o,s,u,h,p=e.length,d=t.length,l=W,f=c(t.length),m=t[d-1],_=Math.ceil(l/(2*m)),y=b(e,_),v=b(t,_);for(y.length<=p&&y.push(0),v.push(0),m=v[d-1],n=p-d;n>=0;n--){for(r=l-1,y[n+d]!==m&&(r=Math.floor((y[n+d]*l+y[n+d-1])/m)),i=0,o=0,u=v.length,s=0;s<u;s++)i+=r*v[s],h=Math.floor(i/l),o+=y[n+s]-(i-h*l),i=h,o<0?(y[n+s]=o+l,o=-1):(y[n+s]=o,o=0);for(;0!==o;){for(r-=1,i=0,s=0;s<u;s++)i+=y[n+s]-l+v[s],i<0?(y[n+s]=i+l,i=0):(y[n+s]=i,i=1);o+=i}f[n]=r}return y=E(y,_)[0],[a(f),a(y)]}function I(e,t){for(var r,n,i,o,s,c=e.length,h=t.length,p=[],d=[],l=W;c;)if(d.unshift(e[--c]),u(d),x(d,t)<0)p.push(0);else{n=d.length,i=d[n-1]*l+d[n-2],o=t[h-1]*l+t[h-2],n>h&&(i=(i+1)*l),r=Math.ceil(i/o);do{if(s=b(t,r),x(s,d)<=0)break;r--}while(r);p.push(r),d=f(d,s)}return p.reverse(),[a(p),a(d)]}function E(e,t){var r,n,i,o,s=e.length,a=c(s),u=W;for(i=0,r=s-1;r>=0;--r)o=i*u+e[r],n=h(o/t),i=o-n*t,a[r]=0|n;return[a,0|i]}function C(e,t){var o,u,c=F(t),p=e.value,d=c.value;if(0===d)throw new Error("Cannot divide by zero");if(e.isSmall)return c.isSmall?[new i(h(p/d)),new i(p%d)]:[r[0],e];if(c.isSmall){if(1===d)return[e,r[0]];if(-1==d)return[e.negate(),r[0]];var l=Math.abs(d);if(l<W){o=E(p,l),u=a(o[0]);var f=o[1];return e.sign&&(f=-f),"number"==typeof u?(e.sign!==c.sign&&(u=-u),[new i(u),new i(f)]):[new n(u,e.sign!==c.sign),new i(f)]}d=s(l)}var m=x(p,d);if(-1===m)return[r[0],e];if(0===m)return[r[e.sign===c.sign?1:-1],r[0]];o=p.length+d.length<=200?T(p,d):I(p,d),u=o[0];var _=e.sign!==c.sign,y=o[1],b=e.sign;return"number"==typeof u?(_&&(u=-u),u=new i(u)):u=new n(u,_),"number"==typeof y?(b&&(y=-y),y=new i(y)):y=new n(y,b),[u,y]}function x(e,t){if(e.length!==t.length)return e.length>t.length?1:-1;for(var r=e.length-1;r>=0;r--)if(e[r]!==t[r])return e[r]>t[r]?1:-1;return 0}function M(e){var t=e.abs();return!t.isUnit()&&(!!(t.equals(2)||t.equals(3)||t.equals(5))||!(t.isEven()||t.isDivisibleBy(3)||t.isDivisibleBy(5))&&(!!t.lesser(25)||void 0))}function q(e){return("number"==typeof e||"string"==typeof e)&&+Math.abs(e)<=W||e instanceof n&&e.value.length<=1}function O(e,r,n){r=F(r);for(var i=e.isNegative(),o=r.isNegative(),s=i?e.not():e,a=o?r.not():r,u=[],c=[],h=!1,p=!1;!h||!p;)s.isZero()?(h=!0,u.push(i?1:0)):i?u.push(s.isEven()?1:0):u.push(s.isEven()?0:1),a.isZero()?(p=!0,c.push(o?1:0)):o?c.push(a.isEven()?1:0):c.push(a.isEven()?0:1),s=s.over(2),a=a.over(2);for(var d=[],l=0;l<u.length;l++)d.push(n(u[l],c[l]));for(var f=t(d.pop()).negate().times(t(2).pow(d.length));d.length;)f=f.add(t(d.pop()).times(t(2).pow(d.length)));return f}function P(e){var t=e.value,r="number"==typeof t?t|X:t[0]+t[1]*W|Y;return r&-r}function A(e,t){return e=F(e),t=F(t),e.greater(t)?e:t}function H(e,t){return e=F(e),t=F(t),e.lesser(t)?e:t}function B(e,t){if(e=F(e).abs(),t=F(t).abs(),e.equals(t))return e;if(e.isZero())return t;if(t.isZero())return e;for(var n,i,o=r[1];e.isEven()&&t.isEven();)n=Math.min(P(e),P(t)),e=e.divide(n),t=t.divide(n),o=o.multiply(n);for(;e.isEven();)e=e.divide(P(e));do{for(;t.isEven();)t=t.divide(P(t));e.greater(t)&&(i=t,t=e,e=i),t=t.subtract(e)}while(!t.isZero());return o.isUnit()?e:e.multiply(o)}function R(e,t){return e=F(e).abs(),t=F(t).abs(),e.divide(B(e,t)).multiply(t)}function D(e,t){e=F(e),t=F(t);var r=H(e,t),o=A(e,t),s=o.subtract(r);if(s.isSmall)return r.add(Math.round(Math.random()*s));for(var u=s.value.length-1,c=[],p=!0,d=u;d>=0;d--){var l=p?s.value[d]:W,f=h(Math.random()*l);c.unshift(f),f<l&&(p=!1)}return c=a(c),r.add("number"==typeof c?new i(c):new n(c,!1))}function N(e,t,n){var i,o=r[0],s=r[1];for(i=e.length-1;i>=0;i--)o=o.add(e[i].times(s)),s=s.times(t);return n?o.negate():o}function j(e){var t=e.value;return"number"==typeof t&&(t=[t]),1===t.length&&t[0]<=35?"0123456789abcdefghijklmnopqrstuvwxyz".charAt(t[0]):"<"+t+">"}function U(e,r){if(r=t(r),r.isZero()){if(e.isZero())return"0";throw new Error("Cannot convert nonzero numbers to base 0.")}if(r.equals(-1))return e.isZero()?"0":e.isNegative()?new Array(1-e).join("10"):"1"+new Array(+e).join("01");var n="";if(e.isNegative()&&r.isPositive()&&(n="-",e=e.abs()),r.equals(1))return e.isZero()?"0":n+new Array(+e+1).join(1);for(var i,o=[],s=e;s.isNegative()||s.compareAbs(r)>=0;){i=s.divmod(r),s=i.quotient;var a=i.remainder;a.isNegative()&&(a=r.minus(a).abs(),s=s.next()),o.push(j(a))}return o.push(j(s)),n+o.reverse().join("")}function z(e){if(o(+e)){var t=+e;if(t===h(t))return new i(t);throw"Invalid integer: "+e}var r="-"===e[0];r&&(e=e.slice(1));var s=e.split(/e/i);if(s.length>2)throw new Error("Invalid integer: "+s.join("e"));if(2===s.length){var a=s[1];if("+"===a[0]&&(a=a.slice(1)),(a=+a)!==h(a)||!o(a))throw new Error("Invalid integer: "+a+" is not a valid exponent.");var c=s[0],p=c.indexOf(".");if(p>=0&&(a-=c.length-p-1,c=c.slice(0,p)+c.slice(p+1)),a<0)throw new Error("Cannot include negative exponent part for integers");c+=new Array(a+1).join("0"),e=c}if(!/^([0-9][0-9]*)$/.test(e))throw new Error("Invalid integer: "+e);for(var d=[],l=e.length,f=V,m=l-f;l>0;)d.push(+e.slice(m,l)),m-=f,m<0&&(m=0),l-=f;return u(d),new n(d,r)}function L(e){if(o(e)){if(e!==h(e))throw new Error(e+" is not an integer.");return new i(e)}return z(e.toString())}function F(e){return"number"==typeof e?L(e):"string"==typeof e?z(e):e}var W=1e7,V=7,Q=9007199254740992,Z=s(Q),G=Math.log(Q);n.prototype=Object.create(r.prototype),i.prototype=Object.create(r.prototype),n.prototype.add=function(e){var t=F(e);if(this.sign!==t.sign)return this.subtract(t.negate());var r=this.value,i=t.value;return t.isSmall?new n(l(r,Math.abs(i)),this.sign):new n(d(r,i),this.sign)},n.prototype.plus=n.prototype.add,i.prototype.add=function(e){var t=F(e),r=this.value;if(r<0!==t.sign)return this.subtract(t.negate());var a=t.value;if(t.isSmall){if(o(r+a))return new i(r+a);a=s(Math.abs(a))}return new n(l(a,Math.abs(r)),r<0)},i.prototype.plus=i.prototype.add,n.prototype.subtract=function(e){var t=F(e);if(this.sign!==t.sign)return this.add(t.negate());var r=this.value,n=t.value;return t.isSmall?_(r,Math.abs(n),this.sign):m(r,n,this.sign)},n.prototype.minus=n.prototype.subtract,i.prototype.subtract=function(e){var t=F(e),r=this.value;if(r<0!==t.sign)return this.add(t.negate());var n=t.value;return t.isSmall?new i(r-n):_(n,Math.abs(r),r>=0)},i.prototype.minus=i.prototype.subtract,n.prototype.negate=function(){return new n(this.value,!this.sign)},i.prototype.negate=function(){var e=this.sign,t=new i(-this.value);return t.sign=!e,t},n.prototype.abs=function(){return new n(this.value,!1)},i.prototype.abs=function(){return new i(Math.abs(this.value))},n.prototype.multiply=function(e){var t,i=F(e),o=this.value,a=i.value,u=this.sign!==i.sign;if(i.isSmall){if(0===a)return r[0];if(1===a)return this;if(-1===a)return this.negate();if((t=Math.abs(a))<W)return new n(b(o,t),u);a=s(t)}return w(o.length,a.length)?new n(g(o,a),u):new n(y(o,a),u)},n.prototype.times=n.prototype.multiply,i.prototype._multiplyBySmall=function(e){return o(e.value*this.value)?new i(e.value*this.value):k(Math.abs(e.value),s(Math.abs(this.value)),this.sign!==e.sign)},n.prototype._multiplyBySmall=function(e){return 0===e.value?r[0]:1===e.value?this:-1===e.value?this.negate():k(Math.abs(e.value),this.value,this.sign!==e.sign)},i.prototype.multiply=function(e){return F(e)._multiplyBySmall(this)},i.prototype.times=i.prototype.multiply,n.prototype.square=function(){return new n(S(this.value),!1)},i.prototype.square=function(){var e=this.value*this.value;return o(e)?new i(e):new n(S(s(Math.abs(this.value))),!1)},n.prototype.divmod=function(e){var t=C(this,e);return{quotient:t[0],remainder:t[1]}},i.prototype.divmod=n.prototype.divmod,n.prototype.divide=function(e){return C(this,e)[0]},i.prototype.over=i.prototype.divide=n.prototype.over=n.prototype.divide,n.prototype.mod=function(e){return C(this,e)[1]},i.prototype.remainder=i.prototype.mod=n.prototype.remainder=n.prototype.mod,n.prototype.pow=function(e){var t,n,s,a=F(e),u=this.value,c=a.value;if(0===c)return r[1];if(0===u)return r[0];if(1===u)return r[1];if(-1===u)return a.isEven()?r[1]:r[-1];if(a.sign)return r[0];if(!a.isSmall)throw new Error("The exponent "+a.toString()+" is too large.");if(this.isSmall&&o(t=Math.pow(u,c)))return new i(h(t));for(n=this,s=r[1];;){if(!0&c&&(s=s.times(n),--c),0===c)break;c/=2,n=n.square()}return s},i.prototype.pow=n.prototype.pow,n.prototype.modPow=function(e,t){if(e=F(e),t=F(t),t.isZero())throw new Error("Cannot take modPow with modulus 0");for(var n=r[1],i=this.mod(t);e.isPositive();){if(i.isZero())return r[0];e.isOdd()&&(n=n.multiply(i).mod(t)),e=e.divide(2),i=i.square().mod(t)}return n},i.prototype.modPow=n.prototype.modPow,n.prototype.compareAbs=function(e){var t=F(e),r=this.value,n=t.value;return t.isSmall?1:x(r,n)},i.prototype.compareAbs=function(e){var t=F(e),r=Math.abs(this.value),n=t.value;return t.isSmall?(n=Math.abs(n),r===n?0:r>n?1:-1):-1},n.prototype.compare=function(e){if(e===1/0)return-1;if(e===-1/0)return 1;var t=F(e),r=this.value,n=t.value;return this.sign!==t.sign?t.sign?1:-1:t.isSmall?this.sign?-1:1:x(r,n)*(this.sign?-1:1)},n.prototype.compareTo=n.prototype.compare,i.prototype.compare=function(e){if(e===1/0)return-1;if(e===-1/0)return 1;var t=F(e),r=this.value,n=t.value;return t.isSmall?r==n?0:r>n?1:-1:r<0!==t.sign?r<0?-1:1:r<0?1:-1},i.prototype.compareTo=i.prototype.compare,n.prototype.equals=function(e){return 0===this.compare(e)},i.prototype.eq=i.prototype.equals=n.prototype.eq=n.prototype.equals,n.prototype.notEquals=function(e){return 0!==this.compare(e)},i.prototype.neq=i.prototype.notEquals=n.prototype.neq=n.prototype.notEquals,n.prototype.greater=function(e){return this.compare(e)>0},i.prototype.gt=i.prototype.greater=n.prototype.gt=n.prototype.greater,n.prototype.lesser=function(e){return this.compare(e)<0},i.prototype.lt=i.prototype.lesser=n.prototype.lt=n.prototype.lesser,n.prototype.greaterOrEquals=function(e){return this.compare(e)>=0},i.prototype.geq=i.prototype.greaterOrEquals=n.prototype.geq=n.prototype.greaterOrEquals,n.prototype.lesserOrEquals=function(e){return this.compare(e)<=0},i.prototype.leq=i.prototype.lesserOrEquals=n.prototype.leq=n.prototype.lesserOrEquals,n.prototype.isEven=function(){return 0==(1&this.value[0])},i.prototype.isEven=function(){return 0==(1&this.value)},n.prototype.isOdd=function(){return 1==(1&this.value[0])},i.prototype.isOdd=function(){return 1==(1&this.value)},n.prototype.isPositive=function(){return!this.sign},i.prototype.isPositive=function(){return this.value>0},n.prototype.isNegative=function(){return this.sign},i.prototype.isNegative=function(){return this.value<0},n.prototype.isUnit=function(){return!1},i.prototype.isUnit=function(){return 1===Math.abs(this.value)},n.prototype.isZero=function(){return!1},i.prototype.isZero=function(){return 0===this.value},n.prototype.isDivisibleBy=function(e){var t=F(e),n=t.value;return 0!==n&&(1===n||(2===n?this.isEven():this.mod(t).equals(r[0])))},i.prototype.isDivisibleBy=n.prototype.isDivisibleBy,n.prototype.isPrime=function(){var e=M(this);if(void 0!==e)return e;for(var n,i,o,s,a=this.abs(),u=a.prev(),c=[2,3,5,7,11,13,17,19],h=u;h.isEven();)h=h.divide(2);for(o=0;o<c.length;o++)if(s=t(c[o]).modPow(h,a),!s.equals(r[1])&&!s.equals(u)){for(i=!0,n=h;i&&n.lesser(u);n=n.multiply(2))s=s.square().mod(a),s.equals(u)&&(i=!1);if(i)return!1}return!0},i.prototype.isPrime=n.prototype.isPrime,n.prototype.isProbablePrime=function(e){var r=M(this);if(void 0!==r)return r;for(var n=this.abs(),i=void 0===e?5:e,o=0;o<i;o++){if(!t.randBetween(2,n.minus(2)).modPow(n.prev(),n).isUnit())return!1}return!0},i.prototype.isProbablePrime=n.prototype.isProbablePrime,n.prototype.modInv=function(e){for(var r,n,i,o=t.zero,s=t.one,a=F(e),u=this.abs();!u.equals(t.zero);)r=a.divide(u),n=o,i=a,o=s,a=u,s=n.subtract(r.multiply(s)),u=i.subtract(r.multiply(u));if(!a.equals(1))throw new Error(this.toString()+" and "+e.toString()+" are not co-prime");return-1===o.compare(0)&&(o=o.add(e)),this.isNegative()?o.negate():o},i.prototype.modInv=n.prototype.modInv,n.prototype.next=function(){var e=this.value;return this.sign?_(e,1,this.sign):new n(l(e,1),this.sign)},i.prototype.next=function(){var e=this.value;return e+1<Q?new i(e+1):new n(Z,!1)},n.prototype.prev=function(){var e=this.value;return this.sign?new n(l(e,1),!0):_(e,1,this.sign)},i.prototype.prev=function(){var e=this.value;return e-1>-Q?new i(e-1):new n(Z,!0)};for(var J=[1];J[J.length-1]<=W;)J.push(2*J[J.length-1]);var K=J.length,$=J[K-1];n.prototype.shiftLeft=function(e){if(!q(e))throw new Error(String(e)+" is too large for shifting.");if((e=+e)<0)return this.shiftRight(-e);for(var t=this;e>=K;)t=t.multiply($),e-=K-1;return t.multiply(J[e])},i.prototype.shiftLeft=n.prototype.shiftLeft,n.prototype.shiftRight=function(e){var t;if(!q(e))throw new Error(String(e)+" is too large for shifting.");if((e=+e)<0)return this.shiftLeft(-e);for(var r=this;e>=K;){if(r.isZero())return r;t=C(r,$),r=t[1].isNegative()?t[0].prev():t[0],e-=K-1}return t=C(r,J[e]),t[1].isNegative()?t[0].prev():t[0]},i.prototype.shiftRight=n.prototype.shiftRight,n.prototype.not=function(){return this.negate().prev()},i.prototype.not=n.prototype.not,n.prototype.and=function(e){return O(this,e,function(e,t){return e&t})},i.prototype.and=n.prototype.and,n.prototype.or=function(e){return O(this,e,function(e,t){return e|t})},i.prototype.or=n.prototype.or,n.prototype.xor=function(e){return O(this,e,function(e,t){return e^t})},i.prototype.xor=n.prototype.xor;var X=1<<30,Y=(W&-W)*(W&-W)|X,ee=function(e,t){var r=e.length;if(2<=t&&t<=36&&r<=G/Math.log(t))return new i(parseInt(e,t));t=F(t);var n,o=[],s="-"===e[0];for(n=s?1:0;n<e.length;n++){var a=e[n].toLowerCase(),u=a.charCodeAt(0);if(48<=u&&u<=57)o.push(F(a));else if(97<=u&&u<=122)o.push(F(a.charCodeAt(0)-87));else{if("<"!==a)throw new Error(a+" is not a valid character");var c=n;do{n++}while(">"!==e[n]);o.push(F(e.slice(c+1,n)))}}return N(o,t,s)};n.prototype.toString=function(e){if(void 0===e&&(e=10),10!==e)return U(this,e);for(var t,r=this.value,n=r.length,i=String(r[--n]),o="0000000";--n>=0;)t=String(r[n]),i+=o.slice(t.length)+t;return(this.sign?"-":"")+i},i.prototype.toString=function(e){return void 0===e&&(e=10),10!=e?U(this,e):String(this.value)},n.prototype.valueOf=function(){return+this.toString()},n.prototype.toJSNumber=n.prototype.valueOf,i.prototype.valueOf=function(){return this.value},i.prototype.toJSNumber=i.prototype.valueOf;for(var te=0;te<1e3;te++)r[te]=new i(te),te>0&&(r[-te]=new i(-te));return r.one=r[1],r.zero=r[0],r.minusOne=r[-1],r.max=A,r.min=H,r.gcd=B,r.lcm=R,r.isInstance=function(e){return e instanceof n||e instanceof i},r.randBetween=D,r.fromArray=function(e,t,r){return N(e.map(F),F(t||10),r)},r}();void 0!==e&&e.hasOwnProperty("exports")&&(e.exports=t)}).call(t,r(15)(e))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e}();t.Header=n},function(module,exports,__webpack_require__){"use strict";var __assign=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(exports,"__esModule",{value:!0});var BigInteger=__webpack_require__(0),helpers_1=__webpack_require__(14),command_1=__webpack_require__(3),message_1=__webpack_require__(10),type_helper_1=__webpack_require__(11),memory_publish_store_1=__webpack_require__(9),memory_bookmark_store_1=__webpack_require__(8),default_subscription_manager_1=__webpack_require__(5),default_authenticator_1=__webpack_require__(13),default_server_chooser_1=__webpack_require__(4),exponential_delay_strategy_1=__webpack_require__(6),fixed_delay_strategy_1=__webpack_require__(7),W3WebSocket=helpers_1.IS_NODE||helpers_1.IS_ELECTRON?eval("require")("websocket").w3cwebsocket:WebSocket;if(helpers_1.IS_BROWSER&&"undefined"==typeof Promise)throw new Error("Promise support is required. Please include es6-promise library");var Client=function(){function e(t){var r=this;this._name=null,this._logonCorrelationId=null,this._serverVersion=null,this._serverIntVersion=0,this._nextSubId=1,this.subscriptions={},this.connection=null,this._isConnected=!1,this.typeHelper=null,this._disconnectHandler=null,this._transportFilter=null,this._stateListenerId=1,this._connectionStateListeners={},this._serverChooser=null,this._delayStrategy=null,this._publishStore=null,this._bookmarkStore=null,this._subscriptionManager=null,this.timeouts={},this._autoAck=!1,this._ackBatch={toAck:{},ackTimeout:void 0,ackBatchSize:0},this._heartbeat=null,this.messageState={inGroup:!1,currentSow:null,mergedHeader:!1,recordsRemaining:0,publishHeader:null},this._errorHandler=function(e){var t=(new Date).toISOString()+" ["+(r._name?"client: "+r._name:"ERROR")+"] >>>";e.name&&e.message?console.error(t,e.name+":",e.message):console.error(t,e)},this._ack=function(e){var t=r._ackBatch.toAck[e];return void 0!==t&&t.length>0?(r.execute(new command_1.Command("sow_delete").topic(e).bookmark(t.join(","))),r._ackBatch.toAck[e]=[],1):0},this._onAckTimer=function(){r._autoAck&&r._isConnected&&(Object.keys(r._ackBatch.toAck).map(function(e){return r._ack(e)}),r._ackBatch.ackTimeout&&(r._ackBatch.ackTimeoutTimerId=setTimeout(r._onAckTimer.bind(r),r._ackBatch.ackTimeout)))},this.makeCommandHandler=function(t,n,i,o,s,a,u){if("logon"===a)return void(r.subscriptions[u]=function(e){if("ack"===e.c&&"processed"===e.a){var t={commandId:u,message:e};"failure"===e.status?i(t):(n(t),delete r.subscriptions[u])}});var c=e.parseAcks(s),h=e.parseAcks(o),p=!1,d=["subscribe","sow_and_subscribe","delta_subscribe","sow_and_delta_subscribe"].indexOf(a)>=0;r.subscriptions[u]=function(o){if(clearTimeout(r.timeouts[o.cid]),delete r.timeouts[o.cid],"ack"===o.c){if("processed"===o.a)if("failure"===o.status)i&&i(new Error(o.reason));else{if("retry"===o.status)return void r.connection.close(4e3,"Authentication token/password must be updated/renewed");if(void 0!==o.opts){var s=e.maxBacklogRegex.exec(o.opts)[1];void 0===s||r._ackBatch.ackTimeout||r._ackBatch.ackBatchSize>+s&&(r._ackBatch.ackBatchSize=+s)}n&&n(u)}var a=c.indexOf(o.a),l=h.indexOf(o.a);a>=0&&t&&(o=message_1.Message.fromObject(o),t(o)),l>=0&&h.splice(l,1),a>=0&&c.splice(a,1),0===c.length&&0===h.length&&(d||delete r.subscriptions[u])}else if("timeout"===o.c)i({commandId:u,message:o});else if(t){o=message_1.Message.fromObject(o);var f=void 0!==o.lp;if(o.bm&&r._bookmarkStore&&!f)r._bookmarkStore.isDiscarded(o)||(r._bookmarkStore.log(o),t(o));else if(f&&r._autoAck)try{t(o),r.ack(o)}catch(e){r.onError(e)}else t(o);n&&!p&&(n(u),p=!0)}}},this.invokeHandler=function(e,t){var n=r.subscriptions[e],i="ack"===t.c;try{i&&"persisted"===t.a&&r.persistedAckReceived(t),n?n(t):!i&&r._lastChanceMessageHandler&&r._lastChanceMessageHandler(t)}catch(e){r._errorHandler&&r._errorHandler(e)}},this.persistedAckReceived=function(e){var t=!1,n=e.reason;if(r._publishStore&&void 0!==e.s){var i=BigInteger(e.s);r._failedWriteHandler&&(["duplicate","not entitled"].indexOf(n)>=0||"failure"===e.status)&&r._publishStore.replaySingle(function(e,t){r._failedWriteHandler(message_1.Message.fromObject(__assign({},e,{data:t})),n)},i),t=!0,r._publishStore.discardUpTo(i);var o=r._publishStore.lastPersisted();null!==o&&r.sequenceId.compare(o)<=0&&(r.sequenceId=o)}else r._failedWriteHandler&&(["duplicate","not entitled"].indexOf(n)>=0||"failure"===e.status)&&(r._failedWriteHandler(e,n),t=!0);var s=void 0!==e.lp;t||!r._bookmarkStore||void 0===e.sub_id||void 0===e.bm||s||"success"===e.status&&void 0!==r.subscriptions[e.sub_id]&&e.bm.length>1&&(t=!0,r._bookmarkStore.persisted(e.sub_id,e.bm)),!t&&r._lastChanceMessageHandler&&r._lastChanceMessageHandler(e)},this.checkAndSendHeartbeat=function(e){!r._heartbeat||r._heartbeat&&!r._heartbeat.timestamp||(e||(new Date).getTime()-r._heartbeat.timestamp.getTime()>1e3*r._heartbeat.interval)&&(r._heartbeat.timestamp=new Date,clearTimeout(r._heartbeat.timeoutId),r._heartbeat.timeoutId=setTimeout(r._heartbeat.onHeartbeatAbsence.bind(r),1e3*r._heartbeat.timeout),r.execute(new command_1.Command("heartbeat").options("beat")))},this.onMessage=function(t){var n=r.messageState;try{var i=void 0;if(n.recordsRemaining)n.mergedHeader?(n.mergedHeader=!1,--n.recordsRemaining,n.currentSow.data=r.typeHelper.deserialize(t.data),r.invokeHandler(n.currentSow.query_id,n.currentSow)):(i=JSON.parse(t.data),n.currentSow.k=i.k,n.currentSow.x=i.x,n.currentSow.ts=i.ts,n.mergedHeader=!0);else{if(n.publishHeader){try{n.publishHeader.data=r.typeHelper.deserialize(t.data)}catch(e){throw n.publishHeader=null,e}for(var o=n.publishHeader.sids.split(","),s=0,a=o;s<a.length;s++){var u=a[s];r.invokeHandler(u,n.publishHeader)}return void(n.publishHeader=null)}switch(i=JSON.parse(t.data),void 0!==i.s&&(i.s=e.seqRegex.exec(t.data)[1]),i.c){case"p":case"publish":case"oof":n.publishHeader=i,r.invokeHandler(i.query_id?i.query_id:i.cid,i);break;case"sow":n.currentSow=i,n.mergedHeader=!1,n.recordsRemaining=i.bs;break;case"group_begin":n.inGroup=!0,r.invokeHandler(i.query_id,i);break;case"group_end":n.inGroup=!1,r.invokeHandler(i.query_id,i);break;case"ack":r.invokeHandler(i.query_id?i.query_id:i.cid,i);break;case"heartbeat":if(r._heartbeat&&r._heartbeat.timestamp){var c=(new Date).getTime()-r._heartbeat.timestamp.getTime();r._heartbeat&&c>1e3*r._heartbeat.interval&&r.checkAndSendHeartbeat(!0)}return}r._heartbeat&&r.checkAndSendHeartbeat(!1)}}catch(e){r.onError({name:"997",message:"Error "+e.message+" encountered while processing message ("+t.data+") from AMPS",stack:null})}},this._broadcastStateChange=function(e){for(var t in r._connectionStateListeners)r._connectionStateListeners[t]&&r._connectionStateListeners[t](e)},this._publishInternal=function(e,t,n,i){if(i)return void r.execute(new command_1.Command(e).topic(t).data(n).addParams(i));var o={c:e,t:t};if(r._publishStore)o.a="persisted",r.sequenceId=r.sequenceId.next(),o.s=r.sequenceId.toString(),r._publishStore.store(__assign({},o,{data:n}));else if(!r.connection||!r._isConnected)throw new Error("Must connect before sending data");if(r.connection&&r._isConnected){var s=JSON.stringify(o),a=void 0;n=r.typeHelper.serialize(n),a=type_helper_1.TypeHelper.littleEndianSizeBuffer(n.length+1);try{if(r._transportFilter&&r._transportFilter(a,!0),r.connection.send(a),r._transportFilter&&r._transportFilter(s,!0),r.connection.send(s),1===n.length)r._transportFilter&&r._transportFilter(n[0],!0),r.connection.send(n[0]);else for(var u=0,c=n;u<c.length;u++){var h=c[u];r._transportFilter&&r._transportFilter(h,!0),r.connection.send(h)}}catch(e){}}},this._name=t||"AMPS-JavaScript-"+(new Date).getTime()}return e.createMemoryBacked=function(t){return new e(t).subscriptionManager(new default_subscription_manager_1.DefaultSubscriptionManager).bookmarkStore(new memory_bookmark_store_1.MemoryBookmarkStore).publishStore(new memory_publish_store_1.MemoryPublishStore)},e.parseAcks=function(e){if("string"!=typeof e)return[];var t={received:!1,processed:!1,completed:!1,persisted:!1,stats:!1};return e.split(",").map(function(e){void 0!==t[e]&&(t[e]=!0)}),Object.keys(t).filter(function(e){return t[e]})},e.prototype.serverVersion=function(){return this._serverVersion},e.prototype.serverVersionAsInt=function(){return this._serverIntVersion},e.prototype.name=function(e){if(e&&e.length>0){if(this._isConnected)throw new Error("Cannot set the client name when connected");return this._name=e,this}return this._name},e.version=function(){return"5.3.0.2.888230.86e318f"},e.prototype.send=function(e,t,r){var n=this;if(!this.connection)throw new Error("Must connect before sending data");if(this._isConnected||"logon"===e.c){void 0!==r&&r>0&&(this.timeouts[e.cid]=setTimeout(function(){return n.onTimeout(e.cid)},r));var i,o=JSON.stringify(e);if(t){t=this.typeHelper.serialize(t),i=type_helper_1.TypeHelper.littleEndianSizeBuffer(t.length+1),this._transportFilter&&this._transportFilter(i,!0),this.connection.send(i),this._transportFilter&&this._transportFilter(o,!0),this.connection.send(o);for(var s=0,a=t;s<a.length;s++){var u=a[s];this._transportFilter&&this._transportFilter(u,!0),this.connection.send(u)}}else i=type_helper_1.TypeHelper.littleEndianSizeBuffer(1),this._transportFilter&&this._transportFilter(i,!0),this.connection.send(i),this._transportFilter&&this._transportFilter(o,!0),this.connection.send(o)}},e.prototype.onTimeout=function(e){this.invokeHandler(e,{c:"timeout",reason:"The command has been timed out."}),delete this.subscriptions[e]},e.prototype.onError=function(e){this._errorHandler&&this._errorHandler(e)},e.prototype.isConnected=function(){return this._isConnected},e.prototype.nextSubId=function(){return(this._nextSubId++).toString()},e.prototype.setMessageHandler=function(e,t){this.subscriptions&&(this.subscriptions[e]=t)},e.prototype.execute=function(t,r,n){var i=this;return new Promise(function(o,s){t.commandId(i.nextSubId());var a="",u=!1,c=!1,h=!1;switch(t.command()){case"subscribe":case"delta_subscribe":if(t.bookmark())if(i._bookmarkStore){a="persisted,";var p=t.bookmark(),d=t.subId()?t.subId():t.commandId();if(p===e.Bookmarks.MOST_RECENT)t.bookmark(i._bookmarkStore.mostRecent(d));else if(p!==e.Bookmarks.NOW&&p!==e.Bookmarks.EPOCH){var l=t.toMessage();i._bookmarkStore.log(l),i._bookmarkStore.discard(l),i._bookmarkStore.persisted(d,l.bm)}}else e.Bookmarks.MOST_RECENT===t.bookmark()&&t.bookmark(e.Bookmarks.EPOCH);u=!0;case"sow_and_subscribe":case"sow_and_delta_subscribe":t.subId()||t.subId(t.commandId()),c=!0;case"sow":u||t.queryId()||t.queryId(t.subId()?t.subId():t.commandId()),a+="processed",!1===c&&(a+=",completed"),u||void 0!==t.batchSize()||t.batchSize(10),i.makeCommandHandler(r,o,s,a,t.ackType(),t.command(),c?t.queryId()?t.queryId():t.subId():t.commandId());break;case"unsubscribe":t.subId()||t.subId("all"),"all"===t.subId()?(i._subscriptionManager&&i._subscriptionManager.clear(),i.subscriptions={}):(i._subscriptionManager&&i._subscriptionManager.unsubscribe(t.subId()),delete i.subscriptions[t.subId()]);case"flush":case"heartbeat":case"stop_timer":a="processed",i.makeCommandHandler(r,o,s,a,t.ackType(),t.command(),c?t.subId():t.commandId());break;case"sow_delete":case"delta_publish":case"publish":h=!0,i._publishStore?(a="persisted",i.sequenceId=i.sequenceId.next(),t.sequenceId(i.sequenceId)):a="",void 0!==t.ackType()&&i.makeCommandHandler(r,null,null,"",t.ackType(),t.command(),t.commandId()),o(t.commandId())}void 0!==t.ackType()?t.ackType(a+","+t.ackType()):"heartbeat"!==t.command()&&t.ackType(a),"logon"===t.command()&&(t.ackType("processed"),i._logonCorrelationId&&t.correlationId(i._logonCorrelationId),t.rawHeader().version=e.version(),i._logonOptions&&t.options(i._logonOptions),t.clientName(i._name),void 0!==i.username&&(t.rawHeader().user_id=i.username,void 0!==i.password&&i.password.length&&(t.rawHeader().pw=i.password)),i.makeCommandHandler(r,o,s,t.ackType(),"",t.command(),t.commandId())),c&&i._subscriptionManager&&i._subscriptionManager.subscribe(t.rawHeader(),i.subscriptions[t.commandId()]);try{h&&i._publishStore&&i._publishStore.store(t.toMessage()),i.connection&&i.send(t.rawHeader(),t.data(),n)}catch(e){s(e)}})},e.prototype.connect=function(t,r,n){var i,o=this,s=null===this._serverChooser||void 0===this._serverChooser;if(s){if(!t)throw new Error("No Server Chooser or URI Provided");var a=new default_server_chooser_1.DefaultServerChooser;a.add(t,r||new default_authenticator_1.DefaultAuthenticator),this._serverChooser=a}this._delayStrategy||s||(this._delayStrategy=new exponential_delay_strategy_1.ExponentialDelayStrategy),this.sequenceId=BigInteger((new Date).getTime().toString()+"000000");var u=function(t,r){var s=o._serverChooser.getCurrentURI();(i=o._serverChooser.getCurrentAuthenticator())||(i=new default_authenticator_1.DefaultAuthenticator);var a,u=helpers_1.Helpers.parseUri(s),h=u.path.split("/"),p=h[1].toLowerCase();if(a=h.length>2?h[2]:"","amps"!==p)throw new Error("Specification of message type requires amps protocol");n&&(o._logonOptions=n),o._logonOptions||(o._logonOptions=""),"true"===u.queryKey.pretty&&o._logonOptions.indexOf("pretty")<0&&(o._logonOptions.length>0?o._logonOptions+=",pretty":o._logonOptions="pretty");var d=u.source.split("?")[0];if(helpers_1.IS_NODE||helpers_1.IS_ELECTRON){var l={};(u.user.length>0||u.password.length>0)&&(l.Authorization="Basic "+new Buffer(u.user+":"+u.password).toString("base64")),o.connection=new W3WebSocket(d,null,null,l,null,{maxReceivedFrameSize:1099511627776,assembleFragments:!0})}else o.connection=new W3WebSocket(d);o.connection.binaryType="arraybuffer",o.typeHelper=type_helper_1.TypeHelper.helper(a),o._isConnected=!1,o.connection.onopen=function(){o._broadcastStateChange(e.ConnectionStateListener.Connected),o.username=u.user,o.password=u.password;try{o.connection.send("json"===a?"text":"binary")}catch(e){return}o._serverChooser.reportSuccess(o.connection),o._delayStrategy&&o._delayStrategy.reset(),t()},o.connection.onclose=function(e){var n=e.reason;if(0===n.length)switch(e.code){case 1002:n="The endpoint is terminating the connection due to a protocol error.";break;case 1003:n="Connection terminated: AMPS received data of a type it cannot accept";break;case 1006:n="Connection Failed";break;case 1007:n="The endpoint is terminating the connection because a message was received that\n                            contained inconsistent data ";break;case 1009:n="Connection terminated: a data frame was received that is too large.";break;case 1011:n="The server is terminating the connection because it encountered an unexpected\n                            condition that prevented it from fulfilling the request.";break;default:n="Unknown error"}c({name:e.code.toString(),message:n},t,r)},o.connection.onerror=function(e){},o.connection.onmessage=function(e){o._transportFilter&&o._transportFilter(e,!1),o.onMessage(e)}},c=function(t,r,n){var i=o._isConnected;o._isConnected=!1,o._serverChooser.reportFailure(t,o.connection),o._broadcastStateChange(e.ConnectionStateListener.Disconnected),o.connection&&(o.connection.onopen=null,o.connection.onmessage=null,o.connection.onerror=null,o.connection.onclose=null,o.connection.close()),o.connection=null,o.subscriptions={},o.messageState={inGroup:!1,currentSow:null,mergedHeader:!1,recordsRemaining:0,publishHeader:null};var s;if(o._disconnectHandler)return n(t),i&&o.onError(t),o._disconnectHandler(o,t);s=i?function(){return h().then(p).then(d).then(l).catch(n)}:u.bind(null,r,n);try{if(!o._delayStrategy)throw t;setTimeout(s,o._delayStrategy.getConnectWaitDuration(o._serverChooser.getCurrentURI()))}catch(t){o._delayStrategy&&o._delayStrategy.reset(),(i||o._nextSubId>2)&&o.onError(t),o.disconnect(),n(t)}},h=function(){return new Promise(function(e,t){o._delayStrategy?setTimeout(function(){try{u(e,t)}catch(e){var r=new Error(e.message+"\n"+o._serverChooser.getError());r.name=e.name,o.onError(r),o._delayStrategy.reset(),o.disconnect(),t(r)}},o._delayStrategy.getConnectWaitDuration(o._serverChooser.getCurrentURI())):u(e,t)})},p=function(){return i.authenticate(o.username,o.password).then(function(e){return o.password=e}).catch(function(e){throw o.disconnect(),e})},d=function(){var e=function(e){var t=e.message;return new Promise(function(e,r){if("ack"===t.c&&"processed"===t.a)switch(t.status){case"success":t.version.indexOf("develop")>=0&&(t.version="5.3.0.2"),o._serverVersion=t.version;var n=t.version.split(".");o._serverIntVersion=+n[0]*Math.pow(10,7)+ +n[1]*Math.pow(10,5)+ +n[2]*Math.pow(10,3)+ +n[3],i.completed(t.user_id,t.pw,t.reason||""),e(t);break;case"retry":o.username=t.user_id,i.retry(t.user_id,t.pw).catch(function(e){throw o.disconnect(),e}).then(function(t){o.password=t,d().then(e).catch(r)});break;default:r(Error(t.reason))}})};return o.execute(new command_1.Command("logon")).then(e)},l=function(t){return o._broadcastStateChange(e.ConnectionStateListener.LoggedOn),void 0!==t&&(t=message_1.Message.fromObject(t)),new Promise(function(r,n){if(o._isConnected=!0,o._heartbeat&&f(),o._subscriptionManager&&(o._subscriptionManager.resubscribe(o),o._broadcastStateChange(e.ConnectionStateListener.Resubscribed)),o._publishStore){o._publishStore.discardUpTo(t.header.sequenceId());var i=o._publishStore.lastPersisted();null!==i&&o.sequenceId.compare(i)<=0&&(o.sequenceId=i);var s=o;!function i(){try{s._publishStore.replay(s.send.bind(s)),s._broadcastStateChange(e.ConnectionStateListener.PublishReplayed),s._ackBatch.ackTimeout&&(clearTimeout(s._ackBatch.ackTimeoutTimerId),s._ackBatch.ackTimeoutTimerId=setTimeout(s._onAckTimer.bind(s),s._ackBatch.ackTimeout)),r(t)}catch(e){s.connection&&s._isConnected?setTimeout(i,500):c(e,r,n)}}()}else o._ackBatch.ackTimeout&&(clearTimeout(o._ackBatch.ackTimeoutTimerId),o._ackBatch.ackTimeoutTimerId=setTimeout(o._onAckTimer.bind(o),o._ackBatch.ackTimeout)),r(t)})},f=function(){o._heartbeat.onHeartbeatAbsence=function(){clearTimeout(o._heartbeat.timeoutId),o._heartbeat.timestamp=null,o._heartbeat.onHeartbeatAbsence=null,c({name:"4000",message:"Heartbeat absence error"},function(){},function(){})},o._heartbeat.timestamp=new Date,o.execute(new command_1.Command("heartbeat").ackType("received").options("start,"+o._heartbeat.interval),function(t){"ack"===t.c&&"received"===t.a&&"success"===t.status&&(o._broadcastStateChange(e.ConnectionStateListener.HeartbeatInitiated),o._isConnected&&o._heartbeat&&(o._heartbeat.timeoutId=setTimeout(o._heartbeat.onHeartbeatAbsence.bind(o),1e3*o._heartbeat.timeout)))}).catch(function(e){o.onError({name:"4000",message:"Heartbeat connection error"})})};return h().then(p).then(d).then(l)},e.prototype.errorHandler=function(e){return"function"==typeof e?(this._errorHandler=e,this):this._errorHandler},e.prototype.failedWriteHandler=function(e){return"function"==typeof e?(this._failedWriteHandler=e,this):this._failedWriteHandler},e.prototype.lastChanceMessageHandler=function(e){return"function"==typeof e?(this._lastChanceMessageHandler=e,this):this._lastChanceMessageHandler},e.prototype.addConnectionStateListener=function(e){if("function"==typeof e)return this._connectionStateListeners[this._stateListenerId]=e,this._stateListenerId++;throw new Error("Invalid connection state listener object was provided")},e.prototype.removeConnectionStateListener=function(e){if(e)try{return void delete this._connectionStateListeners[e]}catch(e){}throw new Error("The connection state listener was not found")},e.prototype.disconnectHandler=function(e){return void 0!==e&&"function"==typeof e?(this._disconnectHandler=e,this):this._disconnectHandler},e.prototype.transportFilter=function(e){return void 0!==e&&"function"==typeof e?(this._transportFilter=e,this):this._transportFilter},e.prototype.heartbeat=function(e,t){return void 0===t&&(t=2*e),this._heartbeat={interval:e,timeout:t},this},e.prototype.logonOptions=function(e){if(void 0!==e){if(this._isConnected)throw new Error("Cannot set the logon options when connected");return this._logonOptions=e,this}return this._logonOptions},e.prototype.serverChooser=function(e){if(void 0!==e){if(this._isConnected)throw new Error("Cannot set the server chooser when connected");return this._serverChooser=e,this}return this._serverChooser},e.prototype.delayStrategy=function(e){return void 0!==e?(this._delayStrategy=e,this):this._delayStrategy},e.prototype.reconnectDelay=function(e){return void 0===e&&(e=200),this._delayStrategy=new fixed_delay_strategy_1.FixedDelayStrategy(e>=0?e:200),this},e.prototype.subscriptionManager=function(e){return void 0!==e?(this._subscriptionManager=e,this):this._subscriptionManager},e.prototype.logonCorrelationId=function(e){if(void 0!==e){if(this._isConnected)throw new Error("Cannot set the logon correlation id when connected");return this._logonCorrelationId=e,this}return this._logonCorrelationId},e.prototype.publishStore=function(e){if(void 0!==e){if(this._isConnected)throw new Error("Cannot set the publish store when connected");return this._publishStore=e,this}return this._publishStore},e.prototype.bookmarkStore=function(e){if(void 0!==e){if(this._isConnected)throw new Error("Cannot set the bookmark store when connected");return this._bookmarkStore=e,this}return this._bookmarkStore},e.prototype.autoAck=function(e){return void 0!==e?(this._autoAck=e,clearTimeout(this._ackBatch.ackTimeoutTimerId),this._isConnected&&this._autoAck&&this._ackBatch.ackTimeout&&(this._ackBatch.ackTimeoutTimerId=setTimeout(this._onAckTimer.bind(this),this._ackBatch.ackTimeout)),this):this._autoAck},e.prototype.ackBatchSize=function(e){var t=this;if("number"==typeof e){if(e<0)throw new Error("Invalid acknowledgement batch size value");return this._ackBatch.ackBatchSize=e,this._autoAck&&(this._isConnected&&Object.keys(this._ackBatch.toAck).map(function(e){var r=t._ackBatch.toAck[e]||[];t._ackBatch.ackBatchSize<=r.length&&t._ack(e)}),e>1&&void 0===this._ackBatch.ackTimeout&&(this._ackBatch.ackTimeout=1e3,this._isConnected&&(clearTimeout(this._ackBatch.ackTimeoutTimerId),this._ackBatch.ackTimeoutTimerId=setTimeout(this._onAckTimer.bind(this),1e3)))),this}return this._ackBatch.ackBatchSize},e.prototype.ackTimeout=function(e){if("number"==typeof e){if(e<0)throw new Error("Invalid acknowledgment batch timeout value");return this._ackBatch.ackTimeout=e,clearTimeout(this._ackBatch.ackTimeoutTimerId),this._autoAck&&this._isConnected&&e>0&&(this._ackBatch.ackTimeoutTimerId=setTimeout(this._onAckTimer.bind(this),e)),this}return this._ackBatch.ackTimeout},e.prototype.disconnect=function(){var t=this;return this._broadcastStateChange(e.ConnectionStateListener.Shutdown),new Promise(function(e,r){var n=function(){t._isConnected=!1,t._heartbeat&&(clearTimeout(t._heartbeat.timeoutId),t._heartbeat.timestamp=null,delete t._heartbeat.onHeartbeatAbsence);for(var r in t.timeouts)clearTimeout(t.timeouts[r]),delete t.timeouts[r];for(var n in t.subscriptions)delete t.subscriptions[n];t.messageState={inGroup:!1,currentSow:null,mergedHeader:!1,recordsRemaining:0,publishHeader:null},t._nextSubId=1,t._ackBatch.toAck={},t.connection&&(t.username=null,t.password=null,t.connection.onclose=null,t.connection.onopen=null,t.connection.onerror=null,t.connection.close(1e3,"Disconnect from the client"),t.connection=null),t._serverChooser=null,t._delayStrategy=null,t.subscriptionManager=null,e()};t._autoAck=!1,t._ackBatch.ackBatchSize=0,clearTimeout(t._ackBatch.ackTimeoutTimerId),t._ackBatch.ackTimeout=void 0;var i=Object.keys(t._ackBatch.toAck);if(i.length>0){for(var o=0,s=0,a=i;s<a.length;s++){var u=a[s];o+=t._ack(u)}o>0?t.flush().then(function(){return n()}).catch(r):n()}else n()})},e.prototype.publish=function(e,t,r){this._publishInternal("publish",e,t,r)},e.prototype.deltaPublish=function(e,t,r){this._publishInternal("delta_publish",e,t,r)},e.prototype.flush=function(e){var t=this;return new Promise(function(r,n){t.execute(new command_1.Command("flush").ackType("completed").clientName(t._name),function(e){"ack"===e.c&&"completed"===e.a&&"success"===e.status?r():n(new Error(e.reason))},e).catch(n)})},e.prototype.subscribe=function(e,t,r,n){if("string"!=typeof t)throw'The topic argument in subscribe must be a string, not a "'+typeof t+'"';if("function"!=typeof e)throw'The message handler argument in subscribe must be a function, not a "'+typeof e+'"';if(void 0===r||null===r)r="";else if("string"!=typeof r)throw'The filter argument in subscribe must be a string, not a "'+typeof r+'"';return this.execute(new command_1.Command("subscribe").topic(t).filter(r).addParams(n),e)},e.prototype.sow=function(e,t,r,n){if("string"!=typeof t)throw'The topic argument in sow must be a string, not a "'+typeof t+'"';if("function"!=typeof e)throw'The message handler argument in sow must be a function, not a "'+typeof e+'"';if(void 0===r||null===r)r="";else if("string"!=typeof r)throw'The filter argument in sow must be a string, not a "'+typeof r+'"';return this.execute(new command_1.Command("sow").topic(t).filter(r).addParams(n),e)},e.prototype.sowAndSubscribe=function(e,t,r,n){if("string"!=typeof t)throw'The topic argument in sow_and_subscribe must be a string, not a "'+typeof t+'"';if("function"!=typeof e)throw'The message handler arg in sow_and_subscribe must be a function, not a "'+typeof e+'"';if(void 0===r||null===r)r="";else if("string"!=typeof r)throw'The filter argument in sow_and_subscribe must be a string, not a "'+typeof r+'"';return this.execute(new command_1.Command("sow_and_subscribe").topic(t).filter(r).addParams(n),e)},e.prototype.deltaSubscribe=function(e,t,r,n){if("string"!=typeof t)throw'The topic argument in delta_subscribe must be a string, not a "'+typeof t+'"';if("function"!=typeof e)throw'The message handler arg in delta_subscribe must be a function, not a "'+typeof e+'"';if(void 0===r||null===r)r="";else if("string"!=typeof r)throw'The filter argument in delta_subscribe be a string, not a "'+typeof r+'"';return this.execute(new command_1.Command("delta_subscribe").topic(t).filter(r).addParams(n),e)},e.prototype.sowAndDeltaSubscribe=function(e,t,r,n){if("string"!=typeof t)throw'The topic argument in sow_and_delta_subscribe must be a string, not a "'+typeof t+'"';if("function"!=typeof e)throw'The message handler arg in sow_and_delta_subscribe must be a function, not a "'+typeof e+'"';if(void 0===r||null===r)r="";else if("string"!=typeof r)throw'The filter argument in sow_and_delta_subscribe must be a string, not a "'+typeof r+'"';return this.execute(new command_1.Command("sow_and_delta_subscribe").topic(t).filter(r).addParams(n),e)},e.prototype.unsubscribe=function(e){if(void 0!==e&&null!==e||(e="all"),"string"!=typeof e)throw'The subId argument in unsubscribe must be a string, not a "'+typeof e+'"';return this.execute(new command_1.Command("unsubscribe").subId(e).ackType("received"))},e.prototype.ack=function(e,t,r){var n;if("string"!=typeof e){if(void 0===e.lp)return;n=e.t,r=t,t=e.bm}else{if("string"!=typeof e)throw"Either a message object or a topic and bookmark strings should be provided in ack()";if(n=e,"string"!=typeof t)throw'The bookmark argument in ack() must be a string, not a "'+typeof t+'"'}if(void 0!==n&&0!==n.length&&void 0!==t&&0!==t.length)if(this._ackBatch.ackBatchSize<=1||"string"==typeof r&&r.length>0){var i=new command_1.Command("sow_delete").topic(n).bookmark(t);"string"==typeof r&&r.length>0&&i.options(r),this.execute(i)}else{var o=this._ackBatch.toAck[n];void 0===o&&(o=[],this._ackBatch.toAck[n]=o),o.push(t),o.length>=this._ackBatch.ackBatchSize&&this._ack(n)}},e.prototype.sowDelete=function(e,t,r){var n=this;if(void 0===e||null===e||""===e)throw"A non-null, defined, non-empty topic argument must be provided";if("string"!=typeof e)throw'The topic argument in sow_delete must be a string, not a "'+typeof e+'"';if(void 0===t||null===t||""===t)throw"A non-null, defined, non-empty filter argument must be provided";if("string"!=typeof t)throw'The filter argument in sow_delete must be a string, not a "'+typeof t+'"';return new Promise(function(i,o){var s=new command_1.Command("sow_delete").topic(e).filter(t).ackType("stats");void 0!==r&&null!==r&&s.options(r),n.execute(s,i).catch(o)})},e.prototype.sowDeleteByData=function(e,t){var r=this;if(void 0===e||null===e||""===e)throw"A non-null, defined, non-empty topic argument must be provided";if("string"!=typeof e)throw'The topic argument in sow_delete must be a string, not a "'+typeof e+'"';if(void 0===t||null===t||""===t)throw"A non-null, defined, non-empty data argument must be provided";return new Promise(function(n,i){r.execute(new command_1.Command("sow_delete").topic(e).data(t).ackType("stats"),n).catch(i)})},e.prototype.sowDeleteByKeys=function(e,t){var r=this;if(void 0===e||null===e||""===e)throw"A non-null, defined, non-empty topic argument must be provided";if("string"!=typeof e)throw'The topic argument in sow_delete must be a string, not a "'+typeof e+'"';if(void 0===t||null===t||""===t)throw"A non-null, defined, non-empty keys argument must be provided";if("string"!=typeof t)throw'The keys argument in sow_delete must be a string, not a "'+typeof t+'"';return new Promise(function(n,i){r.execute(new command_1.Command("sow_delete").topic(e).sowKeys(t).ackType("stats"),n).catch(i)})},e.seqRegex=/"s":(\d+),/,e.maxBacklogRegex=/max_backlog=(\d+)/,e.Bookmarks={MOST_RECENT:"recent",EPOCH:"0",NOW:"0|1|"},e.ConnectionStateListener={Disconnected:0,Shutdown:1,Connected:2,LoggedOn:4,PublishReplayed:8,HeartbeatInitiated:16,Resubscribed:32,UNKNOWN:16834},e}();exports.Client=Client},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(1),o=function(){function e(t){if(this._data=null,e.commandTypes.indexOf(t)<0)throw new Error("Invalid command name");this.header=new i.Header,this.header.c=t}return e.prototype.rawHeader=function(){return this.header},e.prototype.toMessage=function(){var e=this.header;return this._data&&(e.data=this._data),e},e.prototype.command=function(t){if(void 0!==t){if(e.commandTypes.indexOf(t)<0)throw new Error("Invalid command name");return this.header.c=t,this}return this.header.c},e.prototype.commandId=function(e){return void 0!==e?(this.header.cid=e,this):this.header.cid},e.prototype.queryId=function(e){return void 0!==e?(this.header.query_id=e,this):this.header.query_id},e.prototype.subId=function(e){return void 0!==e?(this.header.sub_id=e,this):this.header.sub_id},e.prototype.ackType=function(e){return void 0!==e?(this.header.a=e,this):this.header.a},e.prototype.data=function(e){return void 0!==e?(this._data=e,this):this._data},e.prototype.topN=function(e){return void 0!==e?(this.header.top_n=e,this):this.header.top_n},e.prototype.batchSize=function(e){return void 0!==e?(this.header.bs=e,this):this.header.bs},e.prototype.topic=function(e){return void 0!==e?(this.header.t=e,this):this.header.t},e.prototype.filter=function(e){return void 0!==e?(this.header.filter=e,this):this.header.filter},e.prototype.bookmark=function(e){return void 0!==e?(this.header.bm=e,this):this.header.bm},e.prototype.options=function(e){return void 0!==e?(this.header.o=e,this):this.header.o},e.prototype.correlationId=function(e){return void 0!==e?(this.header.x=e,this):this.header.x},e.prototype.orderBy=function(e){return void 0!==e?(this.header.orderby=e,this):this.header.orderby},e.prototype.sowKey=function(e){return void 0!==e?(this.header.k=e,this):this.header.k},e.prototype.sowKeys=function(e){return void 0!==e?(this.header.sow_keys=e,this):this.header.sow_keys},e.prototype.expiration=function(e){return void 0!==e?(this.header.e=e,this):this.header.e},e.prototype.clientName=function(e){return void 0!==e?(this.header.client_name=e,this):this.header.client_name},e.prototype.sequenceId=function(e){return void 0!==e?(this.header.s=e.toString(),this):n(this.header.s)},e.prototype.subIds=function(e){return void 0!==e?(this.header.sids=e,this):this.header.sids},e.prototype.addParams=function(e){if(null===e||void 0===e)return this;for(var t=Object.keys(e),r=0;r<t.length;++r){var n=t[r];try{this[n](e[n])}catch(e){throw new Error('Parameter "'+n+'" not found.')}}return this},e.prototype.headerCopy=function(){var e=new i.Header;e.c=this.header.c.slice(0);for(var t in this.header)e[t]="string"==typeof this.header[t]?this.header[t].slice(0):this.header[t];return e},e.commandTypes=["logon","publish","delta_publish","subscribe","delta_subscribe","sow","sow_and_subscribe","sow_and_delta_subscribe","sow_delete","unsubscribe","flush","heartbeat","start_timer","stop_timer"],e}();t.Command=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.servers=[],this.index=0,this.error=null}return e.prototype.add=function(e,t){if(void 0===t&&(t=null),0===e.length)throw new Error("Invalid URI");return this.servers.push({uri:e,authenticator:t}),this},e.prototype.addAll=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,n=e;r<n.length;r++){var i=n[r];if(!i)throw new Error("Invalid URI option");"string"==typeof i?this.add(i):this.add(i.uri,i.authenticator)}return this},e.prototype.getCurrentURI=function(){return this.servers.length>0?this.servers[this.index].uri:null},e.prototype.getCurrentAuthenticator=function(){return this.servers.length>0?this.servers[this.index].authenticator:null},e.prototype.reportFailure=function(e,t){this.error=e,this.index=(this.index+1)%this.servers.length},e.prototype.reportSuccess=function(e){this.error=null},e.prototype.getError=function(){return this.error?this.error.message:""},e}();t.DefaultServerChooser=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=function(){function e(e){void 0===e&&(e=0);var t=this;if(this._resubscriptionTimeout=e,this.resubscribeInternal=function(e,r,n){var i=void 0!==n.header.o;i&&(n.header.o=n.header.o.replace(/replace,?/g,"")),n.header.bm&&(!i||n.header.o.indexOf("pause")<0)&&(n.header.bm=r.bookmarkStore().mostRecent(n.header.sub_id)),n.header.cid=r.nextSubId(),r.setMessageHandler(e,n.handler),r.send(n.header,void 0,t._resubscriptionTimeout)},e<0)throw new Error("Invalid value: Cannot use negative argument values");this.activeSubs={},this.resumedSubs={},this.resubscribing=!1}return e.prototype.subscribe=function(t,r){if(t&&(void 0!==t.sub_id||void 0!==t.sids)){if(t=e.copyHeader(t),t.o){var n=t.sub_id+(t.sids?","+t.sids:"").split(",");if(t.o.indexOf("resume")>=0){for(var i=0,o=n;i<o.length;i++){var s=o[i];this.resumedSubs[s]||(this.resumedSubs[s]={header:t,handler:r})}return}if(t.o.indexOf("pause")>=0){for(var a=0,u=n;a<u.length;a++){var s=u[a];if(this.resumedSubs[s]&&delete this.resumedSubs[s],this.activeSubs[s]){if(t.o.indexOf("replace")<0){var c=this.activeSubs[s].o;this.activeSubs[s].o=c?"pause,"+c:"pause";continue}r=this.activeSubs[s].handler}this.activeSubs[s]={header:t,handler:r}}return}}var h=this.activeSubs[t.sub_id];h&&(r=h.handler),this.activeSubs[t.sub_id]={header:t,handler:r}}},e.prototype.unsubscribe=function(e){delete this.activeSubs[e],delete this.resumedSubs[e]},e.prototype.clear=function(){this.activeSubs={},this.resumedSubs={}},e.prototype.resubscriptionTimeout=function(e){if(void 0===e&&(e=0),void 0!==e){if("number"!=typeof e||e<0)throw new Error("Invalid value");this._resubscriptionTimeout=e}return this._resubscriptionTimeout},e.prototype.resubscribe=function(e){var t=this;if(void 0===e||null===e||!e||!e.isConnected())throw new Error("A connected client must be provided");this.resubscribing=!0,Object.keys(this.activeSubs).map(function(r){t.resubscribeInternal(r,e,t.activeSubs[r])}),Object.keys(this.resumedSubs).map(function(r){t.resubscribeInternal(r,e,t.resumedSubs[r])}),this.resubscribing=!1},e.copyHeader=function(e){var t=new n.Header;return t.c=e.c.slice(0),Object.keys(e).map(function(r){t[r]="string"==typeof e[r]?e[r].slice(0):e[r]}),t},e}();t.DefaultSubscriptionManager=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(t,r,n,i,o){if(void 0===r&&(r=2e4),void 0===n&&(n=2),void 0===i&&(i=0),void 0===o&&(o=1),this.firstUri=null,this.recentUri=null,this.currentUri=null,this.currentDelay=-1,"number"!=typeof t&&t&&(r=t.maximumDelay,n=t.backoffExponent,i=t.maximumRetryTime,o=t.jitter,t=t.initialDelay),this._initialDelay="number"!=typeof t?200:t,this._maximumDelay="number"!=typeof r?2e4:r,this._backoffExponent="number"!=typeof n?2:n,this._maximumRetryTime="number"!=typeof i?0:i,this._jitter="number"!=typeof o?1:o,this._initialDelay<0||this._maximumDelay<0||this._backoffExponent<0||this._maximumRetryTime<0||this._jitter<0)throw new Error(e.NEGATIVE_VALUE_ERROR);this.reset()}return e.prototype.initialDelay=function(t){if(void 0===t&&(t=200),t<0)throw new Error(e.NEGATIVE_VALUE_ERROR);return this._initialDelay=t,this.currentDelay=this._initialDelay,this},e.prototype.maximumDelay=function(t){if(void 0===t&&(t=2e4),t<0)throw new Error(e.NEGATIVE_VALUE_ERROR);return this._maximumDelay=t,this},e.prototype.backoffExponent=function(t){if(void 0===t&&(t=2),t<0)throw new Error(e.NEGATIVE_VALUE_ERROR);return this._backoffExponent=t,this},e.prototype.maximumRetryTime=function(t){if(void 0===t&&(t=0),t<0)throw new Error(e.NEGATIVE_VALUE_ERROR);return this._maximumRetryTime=t,this},e.prototype.jitter=function(t){if(void 0===t&&(t=1),t<0)throw new Error(e.NEGATIVE_VALUE_ERROR);return this._jitter=t,this},e.prototype.getConnectWaitDuration=function(e){var t=(new Date).getTime();if(this._maximumRetryTime>0&&this.startTime>=0&&this._maximumRetryTime<=t-this.startTime)throw new Error("Maximum Retry Time Exceeded");var r;return e!==this.recentUri&&e!==this.firstUri?(this.firstUri||(this.firstUri=e,this.startTime=t),r=0):(this.currentDelay=this.currentDelay<0?this._initialDelay:Math.min(this._maximumDelay,this.currentDelay*this._backoffExponent),(r=Math.round(this.currentDelay+Math.random()*this._jitter*this._initialDelay))>this._maximumDelay&&(r=2*this._maximumDelay-r)<this._initialDelay&&(r=this._initialDelay)),this.recentUri=e,r},e.prototype.reset=function(){this.startTime=-1,this.firstUri=null,this.recentUri=null,this.currentUri=null,this.currentDelay=-1},e.NEGATIVE_VALUE_ERROR="Invalid value(s): Cannot use negative argument values",e}();t.ExponentialDelayStrategy=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){if(void 0===t&&(t=0),"number"!=typeof e&&e&&(t=e.maximumRetryTime,e=e.delay),this.delay="number"!=typeof e?200:e,this.maximumRetryTime="number"!=typeof t?0:t,this.delay<0||this.maximumRetryTime<0)throw new Error("Invalid value(s): Cannot use negative argument values");this.reset()}return e.prototype.getConnectWaitDuration=function(e){var t=(new Date).getTime();if(this.maximumRetryTime>0&&this.startTime>=0&&this.maximumRetryTime<=t-this.startTime)throw new Error("Maximum Retry Time Exceeded");var r;return e!==this.recentUri&&e!==this.firstUri?(this.firstUri||(this.firstUri=e,this.startTime=t),r=0):r=this.delay,this.recentUri=e,r},e.prototype.reset=function(){this.startTime=-1,this.firstUri=null,this.recentUri=null},e}();t.FixedDelayStrategy=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(2),o=function(){function e(e){if(this.pubId=null,this.sequenceNumber=null,this.discarded=!1,this.raw=e,e.length>1){if("|"===e.charAt(e.length-1)){var t=e.split("|");this.pubId=t[0],this.sequenceNumber=n(t[1])}}else this.sequenceNumber=n.zero}return e}(),s=function(){function e(e){void 0===e&&(e=!1),this.publishers={},this._bookmarks=[],this.bookmarkMap={},this.lastPersisted=new o("0"),this.lastDiscarded=null,this._noPersistedAcks=e}return e.prototype.bookmarks=function(){return this._bookmarks},e.prototype.persisted=function(e){var t=new o(e);this.lastPersisted&&!this._noPersistedAcks&&t.pubId===this.lastPersisted.pubId&&t.sequenceNumber.lesserOrEquals(this.lastPersisted.sequenceNumber)||(this.lastPersisted=t)},e.prototype.isDiscarded=function(e){var t=this.bookmarkMap[e.bm];if(void 0!==t){var r=this._bookmarks[t];return!(r&&!r.discarded)&&(r||delete this.bookmarkMap[e.bm],!0)}var n=new o(e.bm),i=this.publishers[n.pubId];if(void 0===i||i.lesser(n.sequenceNumber))return this.publishers[n.pubId]=n.sequenceNumber,!1;for(var s=0;s<this._bookmarks.length;s++){var a=this._bookmarks[s];if(a&&a.pubId===n.pubId&&a.sequenceNumber.equals(n.sequenceNumber))return a.discarded}return!0},e.prototype.mostRecent=function(){var e=this;this.updateBookmarkMap();var t=null!==this.lastDiscarded,r=null!==this.lastPersisted;t&&(this._bookmarks.length&&r?t=!1:r&&this.lastPersisted.pubId===this.lastDiscarded.pubId&&(r=this.lastPersisted.sequenceNumber.lesser(this.lastDiscarded.sequenceNumber),t=!r));var n="";t&&(n+=this.lastDiscarded.raw);var s=Object.keys(this.publishers);if(!r&&!t||this.lastPersisted&&this.lastPersisted.raw===i.Client.Bookmarks.EPOCH){if(0===s.length)return null===this.lastPersisted&&(this.lastPersisted=new o(i.Client.Bookmarks.EPOCH)),this.lastPersisted.raw;n.length>0&&(n="");var a=s.map(function(t){return t+"|"+e.publishers[t].toString()+"|"}).join(",");return n.length>0&&(n+=","),n+=a}return r&&(n.length>0&&(n+=","),n+=this.lastPersisted.raw),n},e.prototype.log=function(e){var t=this.bookmarkMap[e];if(void 0!==t)return this._bookmarks[t].sequenceNumber;var r=new o(e);return this._bookmarks.push(r),t=this._bookmarks.length-1,this.bookmarkMap[e]=t,r.sequenceNumber},e.prototype.discard=function(e){var t=this.bookmarkMap[e];if(void 0!==t){var r=this._bookmarks[t];if(r.discarded=!0,0===t){for(var n=0;r.discarded&&(!this.lastPersisted&&this._noPersistedAcks||r.sequenceNumber.lesserOrEquals(this.lastPersisted.sequenceNumber))&&n<this._bookmarks.length;)r=this._bookmarks[n++],this.lastDiscarded=r;this._bookmarks.splice(0,n),this.updateBookmarkMap()}}},e.prototype.noPersistedAcks=function(){this._noPersistedAcks=!0},e.prototype.updateBookmarkMap=function(){this.bookmarkMap={};for(var e=0;e<this._bookmarks.length;e++){var t=this._bookmarks[e];t&&(this.bookmarkMap[t.raw]=e)}},e}(),a=function(){function e(){this.subscriptionsInfo={}}return e.prototype.log=function(e){return this.findSubscription(e.sub_id?e.sub_id:e.sids).log(e.bm)},e.prototype.discard=function(e,t){if("string"!=typeof e){if(void 0===e.s&&!(t=e.bm))throw new Error("Invalid bookmark value has been provided");e=e.sub_id?e.sub_id:e.sids}this.findSubscription(e).discard(t)},e.prototype.mostRecent=function(e){return this.findSubscription(e).mostRecent()},e.prototype.isDiscarded=function(e){return this.findSubscription(e.sub_id?e.sub_id:e.sids).isDiscarded(e)},e.prototype.purge=function(e){void 0!==e?delete this.subscriptionsInfo[e]:this.subscriptionsInfo={}},e.prototype.oldestBookmarkSeq=function(e){try{return this.findSubscription(e).bookmarks()[0].sequenceNumber}catch(e){}return n(0)},e.prototype.persisted=function(e,t){this.findSubscription(e).persisted(t)},e.prototype.noPersistedAcks=function(e){this.findSubscription(e).noPersistedAcks()},e.prototype.findSubscription=function(e){var t=this.subscriptionsInfo[e];return t||(t=new s,this.subscriptionsInfo[e]=t),t},e}();t.MemoryBookmarkStore=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(){function e(){this.messageQueue=[],this._lastPersisted=null,this._lowestUnpersisted=null}return e.prototype.store=function(e){if("publish"!==e.c&&"delta_publish"!==e.c&&"sow_delete"!==e.c)throw new Error("Invalid message type to store");if(this.messageQueue.length>0&&this.messageQueue[this.messageQueue.length-1].sequence.compare(e.s)>=0)throw new Error("Sequence id is not increasing");this.messageQueue.push({sequence:n(e.s),header:e,data:e.data}),delete e.data},e.prototype.replay=function(e){for(var t=0,r=this.messageQueue;t<r.length;t++){var n=r[t];e(n.header,n.data)}},e.prototype.replaySingle=function(e,t){var r=this.findQueueIndex(t);if(!(r<0)){var n=this.messageQueue[r];e(n.header,n.data)}},e.prototype.discardUpTo=function(e){var t=this.findQueueIndex(e);0===this.messageQueue.length||t<0||((null===this._lastPersisted||this._lastPersisted.compare(e)<0)&&(this._lastPersisted=e),this.messageQueue.splice(0,t+1),this.messageQueue.length>0?this._lowestUnpersisted=this.messageQueue[0].sequence:this._lowestUnpersisted=null)},e.prototype.unpersistedCount=function(){return this.messageQueue.length},e.prototype.lowestUnpersisted=function(){return this._lowestUnpersisted},e.prototype.lastPersisted=function(){return this._lastPersisted},e.prototype.findQueueIndex=function(e){var t=0,r=this.messageQueue.length,n=r-1,i=-1;if(0===r||this.messageQueue[0].sequence.compare(e)>0)return i;for(var o;t<r;)if(o=Math.floor((t+r)/2),this.messageQueue[o].sequence.compare(e)>0)r=o;else{if(this.messageQueue[o].sequence.compare(e)<=0&&(o===n||this.messageQueue[o+1].sequence.compare(e)>0)){i=o;break}t=o+1}return i},e}();t.MemoryPublishStore=i},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=r(1),s=function(){function e(e){this._header=e}return e.prototype.command=function(){return this._header.c},e.prototype.commandId=function(){return this._header.cid},e.prototype.queryId=function(){return this._header.query_id},e.prototype.subId=function(){return this._header.sub_id},e.prototype.ackType=function(){return this._header.a},e.prototype.topN=function(){return this._header.top_n},e.prototype.batchSize=function(){return this._header.bs},e.prototype.topic=function(){return this._header.t},e.prototype.bookmark=function(){return this._header.bm},e.prototype.options=function(){return this._header.o?this._header.o:this._header.opts},e.prototype.correlationId=function(){return this._header.x},e.prototype.orderBy=function(){return this._header.orderby},e.prototype.sowKey=function(){return this._header.k},e.prototype.sowKeys=function(){return this._header.sow_keys},e.prototype.expiration=function(){return this._header.e},e.prototype.clientName=function(){return this._header.client_name},e.prototype.sequenceId=function(){if(void 0!==this._header.s)return i(this._header.s)},e.prototype.subIds=function(){return this._header.sids},e.prototype.filter=function(){return this._header.filter?this._header.filter:this._header.f},e.prototype.timestamp=function(){return this._header.ts},e.prototype.topicMatches=function(){return this._header.topic_matches},e.prototype.userId=function(){return this._header.user_id},e.prototype.reason=function(){return this._header.reason},e.prototype.recordsDeleted=function(){return this._header.records_deleted},e.prototype.recordsInserted=function(){return this._header.records_inserted},e.prototype.recordsReturned=function(){return this._header.records_returned},e.prototype.recordsUpdated=function(){return this._header.records_updated},e.prototype.leasePeriod=function(){return this._header.lp},e.prototype.transmissionTime=function(){return this._header.transmission_time},e.prototype.matches=function(){return this._header.matches},e.prototype.messageLength=function(){return this._header.l},e.prototype.groupSequenceNumber=function(){return this._header.gseq},e.prototype.status=function(){return this._header.status},e}();t.MessageHeader=s;var a=function(e){function t(){var t=e.call(this)||this;return t.header=new s(t),t}return n(t,e),t.fromObject=function(e){return e.header=new s(e),e},t}(o.Header);t.Message=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){void 0===e&&(e=""),this._delimiter=e}return e.prototype.serialize=function(e){return"string"==typeof e?[e]:[Object.keys(e).map(function(t){return t+"="+e[t]}).join(this._delimiter)+this._delimiter]},e.prototype.deserialize=function(e){var t={};return decodeURIComponent(escape(i.Uint8ToString(new Uint8Array(e)))).split(this._delimiter).filter(function(e){return e.length>0}).map(function(e){var r=e.split("="),n=r[0];2===r.length?t[n]=r[1]:t[n]=e.slice(n.length+1)}),t},e.prototype.delimiter=function(e){return void 0!==e?(this._delimiter=e,this):this._delimiter},e}();t.FixTypeHelper=n;var i=function(){function e(){}return e.getInstance=function(){return e.instance||(e.instance=e.createInstance()),e.instance},e.createInstance=function(){return{json:{serialize:function(e){return"string"==typeof e?[e]:[JSON.stringify(e)]},deserialize:function(e){return"string"==typeof e?JSON.parse(e):JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e)))}},binary:{serialize:function(e){return[e]},deserialize:function(e){return e}},fix:new n,nvfix:new n}},e.littleEndianSizeBuffer=function(e){var t=new Uint32Array(1);return t[0]=e,t},e.bigEndianSizeBuffer=function(e){var t=new Uint32Array(1);return t[0]=(255&e)<<24|(65280&e)<<8|(16711680&e)>>>8|(4278190080&e)>>>24,t},e.Uint8ToString=function(e){for(var t=[],r=0;r<e.length;r+=32768)t.push(String.fromCharCode.apply(null,e.subarray(r,r+32768)));return t.join("")},e.convertToArrayBuffers=function(e){for(var t=[],r=0,n=e;r<n.length;r++){var i=n[r];if(i.constructor===String){for(var o=unescape(encodeURIComponent(i)),s=new Uint8Array(o.length),a=0;a<o.length;++a)s[a]=o.charCodeAt(a);t.push(s)}else t.push(i)}return t},e.helper=function(t,r){var n=e.getInstance();return void 0!==r?(n[t]=r,r):void 0!==n[t]?n[t]:n.binary},e.compositeHelper=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t.map(function(t){return e.helper(t)});return{helpers:n,serialize:function(t){if(t.length>n.length)throw"too many elements to serialize";for(var r=[],i=0;i<t.length;++i){var o=e.convertToArrayBuffers(n[i].serialize(t[i]));r=r.concat(e.bigEndianSizeBuffer(o[0].length),o)}return r},deserialize:function(e){for(var t=[],r=0,i=0;e.byteLength-r>0;){var o=new Uint8Array(e,r,4);r+=4;var s=o[0]<<24|o[1]<<16|o[2]<<8|o[3];t.push(n[i].deserialize(new Uint8Array(e,r,s))),r+=s,++i}return t}}},e}();t.TypeHelper=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);t.BigInteger=n;var i=r(2);t.Client=i.Client;var o=r(1);t.Header=o.Header;var s=r(3);t.Command=s.Command;var a=r(10);t.Message=a.Message;var u=r(4);t.DefaultServerChooser=u.DefaultServerChooser;var c=r(5);t.DefaultSubscriptionManager=c.DefaultSubscriptionManager;var h=r(6);t.ExponentialDelayStrategy=h.ExponentialDelayStrategy;var p=r(7);t.FixedDelayStrategy=p.FixedDelayStrategy;var d=r(8);t.MemoryBookmarkStore=d.MemoryBookmarkStore;var l=r(9);t.MemoryPublishStore=l.MemoryPublishStore;var f=r(11);t.TypeHelper=f.TypeHelper},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.authenticate=function(e,t){return new Promise(function(e){return e(t)})},e.prototype.retry=function(e,t){return new Promise(function(e){return e(t)})},e.prototype.completed=function(e,t,r){},e}();t.DefaultAuthenticator=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){for(var t=this.parseUri.options,r=t.parser[t.strictMode?"strict":"loose"].exec(e),n={},i=14;i--;)n[t.key[i]]=r[i]||"";return n[t.q.name]={},n[t.key[12]].replace(t.q.parser,function(e,r,i){r&&(n[t.q.name][r]=i)}),n};n.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var i=function(){function e(){}return e.parseUri=n,e}();t.Helpers=i;var o=!1,s="undefined"!=typeof window&&window.fin&&window.fin.desktop,a=!1;try{a="[object process]"===Object.prototype.toString.call(global.process)}catch(e){}var u="undefined"!=typeof window&&window.process&&window.process.versions&&window.process.versions.electron,c=!a&&"undefined"==typeof window&&void 0!==e&&void 0!==e.exports;o=!s&&!a&&!u,t.IS_BROWSER=o,t.IS_NODE=a,t.IS_OPENFIN=s,t.IS_ELECTRON=u,t.IS_WEBWORKER=c},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}}])});
//# sourceMappingURL=amps.min.js.map